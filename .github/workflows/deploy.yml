name: Deploy to Railway

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
<<<<<<< HEAD
      contents: write
=======
      contents: write  # Ensures repo access
>>>>>>> 1233acd (Fix deploy issue)
      actions: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Debug Secrets
        run: |
          if [[ -z "${{ secrets.RAILWAY_TOKEN }}" ]]; then
            echo "‚ùå RAILWAY_TOKEN is missing!"
            exit 1
          fi
          echo "‚úÖ RAILWAY_TOKEN is set."

<<<<<<< HEAD
      - name: Deploy via API
        run: |
          curl -X POST "https://api.railway.app/graphql/v2" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            --data-raw '{"query":"mutation { deployProject(id: \"f048f3ca-1331-4931-bc33-063e0894822c\") { id } }"}'
=======
      - name: Configure Git Authentication
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git remote set-url origin https://x-access-token:${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git
          git fetch --all --tags
          git checkout main

      - name: Debug Git Status
        run: |
          git status
          git log --oneline -n 5
          git branch -a

      - name: Install Railway CLI
        run: |
          curl -fsSL https://railway.app/install.sh | sh
          echo "$HOME/.railway/bin" >> $GITHUB_PATH

      - name: Deploy to Railway
        uses: jzeuzs/action-railway@v1.1.4
        with:
          railway_token: ${{ secrets.RAILWAY_TOKEN }}

      - name: Debug Deployment
        if: failure()
        run: |
          echo "üö® Deployment failed. Checking logs..."
          git status
          git remote -v
          git log --oneline -n 5
>>>>>>> 1233acd (Fix deploy issue)
